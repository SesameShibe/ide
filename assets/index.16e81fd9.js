var e=Object.defineProperty,t=(t,n,i)=>(((t,n,i)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i})(t,"symbol"!=typeof n?n+"":n,i),i);import{x as n,a as i,W as r,b as o,e as s,K as a,c as d}from"./vendor.d9b4d2f7.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var l,c,h,u;l=document.getElementById("resizor"),c=document.getElementById("left"),h=document.getElementById("right"),u=document.getElementById("container"),l.onmousedown=function(e){var t=e.clientX;return l.left=l.offsetLeft,document.onmousemove=function(e){var n=e.clientX,i=l.left+(n-t),r=u.clientWidth-l.offsetWidth;i<200&&(i=200),i>r-150&&(i=r-150),l.style.left=i,c.style.width=i+"px",h.style.width=u.clientWidth-i-10+"px"},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null,l.releaseCapture&&l.releaseCapture()},l.setCapture&&l.setCapture(),!1},window.addEventListener("resize",(()=>{c.style.width=u.clientWidth-h.clientWidth-l.clientWidth+"px"}));class m{constructor(e=[]){t(this,"data"),t(this,"index"),this.data=e,this.index=e.length}last(){return 0===this.data.length?"":(this.index--,this.index<0&&(this.index=0),this.data[this.index])}next(){return this.index++,this.index>=this.data.length?(this.index=this.data.length,""):this.data[this.index]}add(e){this.data.push(e),this.data.length>=100&&this.data.shift(),this.index=this.data.length}}class f extends i.exports.Terminal{constructor(...e){super(...e),t(this,"end",new Uint8Array([248])),t(this,"decoder",new TextDecoder("utf-8")),t(this,"backend"),t(this,"history"),this.history=new m}setBackend(e){this.backend=e,e.onData((e=>{this.write(this.decoder.decode(e).replace(/\n/g,"\r\n"))}));let t="";this.onKey((e=>{const n=e.domEvent,i=!n.altKey&&!n.ctrlKey&&!n.metaKey&&"ArrowLeft"!==n.key&&"ArrowRight"!==n.key;"Enter"===n.key?(this.write("\r\n"),this.sendStr(t),this.history.add(t),t=""):"Backspace"===n.code?(t=t.slice(0,-1),this.write("\b \b")):"ArrowUp"===n.key?(t=this.history.last(),this.write("[2K\r"+t)):"ArrowDown"===n.key?(t=this.history.next(),this.write("[2K\r"+t)):i&&(this.write(e.key),t+=e.key)}))}sendStr(e){return this.backend?(this.backend.writeStr(e),this.backend.write(this.end),!0):(alert("the backend is not set"),!1)}}const p=new f({windowsMode:["Windows","Win16","Win32","WinCE"].indexOf(navigator.platform)>=0,cursorBlink:!0,fontFamily:"Fira Code, courier-new, courier, monospace",theme:{foreground:"#ffffff"}}),w=new n.exports.FitAddon;p.open(document.getElementById("right")),p.loadAddon(w),w.fit(),window.MonacoEnvironment={getWorker:(e,t)=>"typescript"===t||"javascript"===t?new r:new o};let y=localStorage.getItem("code");null===y&&(y="(function hello() {\n\tprint('Hello mcu.js!');\n})()\n");const g=s.create(document.getElementById("left"),{value:y,language:"javascript",automaticLayout:!0,minimap:{enabled:!1}});function k(){localStorage.setItem("code",g.getValue())}setInterval(k,6e4),g.addCommand(a.CtrlCmd|d.KEY_S,(function(){k()}));console.log(g),console.log(p);const b=new class extends class{constructor(){t(this,"encoder"),this.encoder=new TextEncoder}writeStr(e){return this.write(this.encoder.encode(e))}}{constructor(){super(...arguments),t(this,"port"),t(this,"writer"),t(this,"reader"),t(this,"keepReading",!0)}async setup(){if(!("serial"in navigator))return alert("WebSerial is not supported in your browser."),!1;try{this.port=await navigator.serial.requestPort()}catch(e){return console.log(e),!1}return await this.port.open({baudRate:115200}),this.port.writable?(this.writer=this.port.writable.getWriter(),!0):(this.port.close(),!1)}async onData(e){if(void 0===this.port)throw new Error("Device not connected...");for(;this.port.readable&&this.keepReading;){this.reader=this.port.readable.getReader();try{for(;;){const{value:t,done:n}=await this.reader.read();if(n){this.reader.releaseLock();break}e(t)}}catch(t){console.log(t)}finally{this.reader.releaseLock()}}return!0}write(e){return void 0===this.writer?(console.log("write: writer is undefined"),!1):(this.writer.write(e),!0)}async close(){var e,t,n;this.keepReading=!1,await(null==(e=this.reader)?void 0:e.cancel()),null==(t=this.writer)||t.releaseLock(),null==(n=this.port)||n.close()}};document.getElementById("btn_connect").onclick=async function(){await b.setup()?p.setBackend(b):alert("serial setup failed!"),this.onclick=null},document.getElementById("btn_run").onclick=()=>{p.sendStr(g.getValue())&&p.writeln("[1;32m<IDE CODE>[m")},document.getElementById("btn_save").onclick=()=>{localStorage.setItem("code",g.getValue()),alert("saved")};let v=document.getElementById("open");v.addEventListener("change",(function(){if(this.files){let e=this.files[0],t=new FileReader;t.onload=function(){g.setValue(this.result)},t.readAsText(e)}})),document.getElementById("btn_open").onclick=()=>{v.click()};
